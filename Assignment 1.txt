USE DATABASE DEMODATABASE;
CREATE or replace table ASSIGMENT_1

(    order_id VARCHAR2(50) NOT NULL PRIMARY KEY,
     order_date VARCHAR2(60),
     ship_date VARCHAR2(60),
     ship_mode VARCHAR2(60),
     customer_name VARCHAR2(60),
     segment VARCHAR2(60),
     state VARCHAR2(60),
     country VARCHAR2(60),
     market VARCHAR2(60),
     region VARCHAR2(60),
     product_id VARCHAR2(60),
     category VARCHAR2(60),
     sub_category VARCHAR2(60),
     product_name VARCHAR2(200),
     sales NUMBER(10,2),
     quantity INT,
     discount FLOAT,
     profit FLOAT,
     shipping_cost FLOAT,
     order_priority VARCHAR2(60),
     year VARCHAR2(60)
);

select * from ASSIGMENT_1;
DESC TABLE ASSIGMENT_1;

--1.SET PRIMARY KEY.

-- Primary key already exists in order_id.

--2. CHECK THE ORDER DATE AND SHIP DATE TYPE AND THINK IN WHICH DATA TYPE YOU HAVE TO CHANGE.

UPDATE ASSIGMENT_1
SET order_date = to_date(order_date,'DD.MM.YYYY');

ALTER TABLE ASSIGMENT_1
MODIFY COLUMN order_date DATE;

--3. EXTACT THE LAST NUMBER AFTER THE - AND CREATE OTHER COLUMN AND UPDATE IT.

ALTER TABLE ASSIGMENT_1
ADD COLUMN NUMBER_ID VARCHAR2(20);

UPDATE ASSIGMENT_1
SET NUMBER_ID = (substr(order_id,9));

--4.  FLAG ,IF DISCOUNT IS GREATER THEN 0 THEN  YES ELSE FALSE AND PUT IT IN NEW COLUMN FOR EVERY ORDER ID.

ALTER TABLE ASSIGMENT_1
ADD COLUMN DISCOUNT_FLAG VARCHAR2(10);

UPDATE ASSIGMENT_1
SET DISCOUNT_FLAG = (
                     CASE 
                         WHEN DISCOUNT > 0 THEN 'Yes'
                         ELSE 'False'
                     END
                     );

--5.  FIND OUT THE FINAL PROFIT AND PUT IT IN COLUMN FOR EVERY ORDER ID.

ALTER TABLE ASSIGMENT_1
ADD COLUMN FINAL_PROFIT FLOAT;

UPDATE ASSIGMENT_1
SET FINAL_PROFIT = (PROFIT - SHIPPING_COST);

--6.  FIND OUT HOW MUCH DAYS TAKEN FOR EACH ORDER TO PROCESS FOR THE SHIPMENT FOR EVERY ORDER ID.

ALTER TABLE ASSIGMENT_1
ADD COLUMN SHIPMENT_DAYS INTEGER;

UPDATE ASSIGMENT_1
SET ship_date = to_date(ship_date,'DD.MM.YYYY');

UPDATE ASSIGMENT_1
SET SHIPMENT_DAYS = datediff('day', order_date, ship_date);

/*7 . FLAG THE PROCESS DAY AS BY RATING IF IT TAKES LESS OR EQUAL 3  DAYS MAKE 5,
LESS OR EQUAL THAN 6 DAYS BUT MORE THAN 3 MAKE 4,
LESS THAN 10 BUT MORE THAN 6 MAKE 3,MORE THAN 10 MAKE IT 2 FOR EVERY ORDER ID.*/

ALTER TABLE ASSIGMENT_1
ADD COLUMN RATING INTEGER;

UPDATE ASSIGMENT_1
SET RATING = (   
             CASE
                 WHEN SHIPMENT_DAYS <= 3 THEN 5
                 WHEN SHIPMENT_DAYS <= 6 AND SHIPMENT_DAYS > 3 THEN 4
                 WHEN SHIPMENT_DAYS <= 10 AND SHIPMENT_DAYS > 6 THEN 3
                 ELSE 2
             END
             );